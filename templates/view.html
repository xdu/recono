{% extends "base.html" %}

{% block title %}View PDF - Page {{ page }} - Recono{% endblock %}

{% block content %}
<div class="content-header">
    <h1>{{ filename }}</h1>
    <p>Page {{ page }} of {{ total_pages }} • PDF Document Viewer</p>
</div>

<div class="content-body">
    <!-- Navigation Controls -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding: 1rem; background: var(--secondary-color); border-radius: var(--radius-lg); border: 1px solid var(--border-light);">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <a class="btn btn-secondary" href="{{ url_for('upload') }}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m12 19-7-7 7-7"></path>
                    <path d="m19 12-7 7-7-7"></path>
                </svg>
                Back to Files
            </a>
            
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <label style="font-size: 0.875rem; font-weight: 500; color: var(--text-secondary);">Page:</label>
                <select class="form-input" style="width: auto; min-width: 100px;" onchange="window.location.href = this.value;">
                    {% for i in range(1, total_pages + 1) %}
                        <option value="{{ url_for('view_pdf', filename=filename, page=i) }}" {% if page == i %}selected{% endif %}>{{ i }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div style="display: flex; align-items: center; gap: 0.75rem;">
            {% if page > 1 %}
                <a class="btn btn-secondary" href="{{ url_for('view_pdf', filename=filename, page=page-1) }}">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m15 18-6-6 6-6"></path>
                    </svg>
                    Previous
                </a>
            {% else %}
                <button class="btn btn-secondary" disabled style="opacity: 0.5;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m15 18-6-6 6-6"></path>
                    </svg>
                    Previous
                </button>
            {% endif %}
            
            {% if page < total_pages %}
                <a class="btn btn-secondary" href="{{ url_for('view_pdf', filename=filename, page=page+1) }}">
                    Next
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m9 18 6-6-6-6"></path>
                    </svg>
                </a>
            {% else %}
                <button class="btn btn-secondary" disabled style="opacity: 0.5;">
                    Next
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m9 18 6-6-6-6"></path>
                    </svg>
                </button>
            {% endif %}
        </div>
    </div>

    <!-- Action Buttons -->
    <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
        <a class="btn btn-primary" href="{{ url_for('view_text', filename=filename, start=page) }}">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14,2 14,8 20,8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg>
            Extract Text
        </a>
        
        <a class="btn btn-secondary" href="{{ url_for('edit_text', filename=filename, page=page) }}">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Edit Text
        </a>
        
        <a class="btn btn-secondary" href="{{ url_for('export_pdf', filename=filename, default_page=page) }}">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17,8 12,3 7,8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            Export Pages
        </a>
    </div>

    <!-- PDF Page Display -->
    <div class="card">
        <div class="card-body" style="text-align: center; padding: 2rem;">
            <div style="position: relative; display: inline-block; max-width: 100%;">
                <img 
                    src="{{ image_url }}" 
                    alt="Page {{ page }} of {{ filename }}"
                    style="max-width: 100%; height: auto; border-radius: var(--radius-md); box-shadow: var(--shadow-lg); cursor: pointer;"
                    onclick="openFullscreen(this)"
                >
                <div class="badge badge-info" style="position: absolute; top: 1rem; right: 1rem;">
                    Page {{ page }}/{{ total_pages }}
                </div>
            </div>
            
            <div style="margin-top: 1.5rem; display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
                <button class="btn btn-secondary btn-sm" onclick="zoomIn()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                        <line x1="11" y1="8" x2="11" y2="14"></line>
                        <line x1="8" y1="11" x2="14" y2="11"></line>
                    </svg>
                    Zoom In
                </button>
                
                <button class="btn btn-secondary btn-sm" onclick="zoomOut()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                        <line x1="8" y1="11" x2="14" y2="11"></line>
                    </svg>
                    Zoom Out
                </button>
                
                <button class="btn btn-secondary btn-sm" onclick="resetZoom()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3v18h18"></path>
                        <path d="m19 9-5 5-4-4-3 3"></path>
                    </svg>
                    Reset
                </button>
            </div>
        </div>
    </div>

    <!-- Progress Bar (hidden by default) -->
    <div id="progress-container" style="margin-top: 2rem; display: none;">
        <div class="card">
            <div class="card-body">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--primary-color);">
                        <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9c1.66 0 3.22.45 4.56 1.23"></path>
                        <path d="M16 12l-4-4-4 4"></path>
                        <path d="M12 16V8"></path>
                    </svg>
                    <span style="font-weight: 500;">Processing...</span>
                </div>
                <div class="progress-container">
                    <div id="export-progress" class="progress-bar" style="width: 0%;"></div>
                </div>
                <div id="progress-percentage" style="text-align: center; margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">0%</div>
            </div>
        </div>
    </div>
</div>

<script>
let currentZoom = 1;
const zoomStep = 0.2;
const maxZoom = 3;
const minZoom = 0.5;

function zoomIn() {
    if (currentZoom < maxZoom) {
        currentZoom += zoomStep;
        applyZoom();
    }
}

function zoomOut() {
    if (currentZoom > minZoom) {
        currentZoom -= zoomStep;
        applyZoom();
    }
}

function resetZoom() {
    currentZoom = 1;
    applyZoom();
}

function applyZoom() {
    const img = document.querySelector('.card-body img');
    if (img) {
        img.style.transform = `scale(${currentZoom})`;
        img.style.transition = 'transform 0.2s ease';
    }
}

function openFullscreen(img) {
    if (img.requestFullscreen) {
        img.requestFullscreen();
    } else if (img.webkitRequestFullscreen) {
        img.webkitRequestFullscreen();
    } else if (img.msRequestFullscreen) {
        img.msRequestFullscreen();
    }
}

// Keyboard navigation
document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft' && {{ page }} > 1) {
        window.location.href = "{{ url_for('view_pdf', filename=filename, page=page-1) }}";
    } else if (e.key === 'ArrowRight' && {{ page }} < {{ total_pages }}) {
        window.location.href = "{{ url_for('view_pdf', filename=filename, page=page+1) }}";
    } else if (e.key === 'Escape') {
        if (document.fullscreenElement) {
            document.exitFullscreen();
        }
    }
});

// Add keyboard shortcuts info
document.addEventListener('DOMContentLoaded', function() {
    const tooltip = document.createElement('div');
    tooltip.style.cssText = `
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: var(--text-primary);
        color: white;
        padding: 0.75rem 1rem;
        border-radius: var(--radius-md);
        font-size: 0.75rem;
        opacity: 0.8;
        z-index: 1000;
    `;
    tooltip.innerHTML = '← → Navigate pages • ESC Exit fullscreen';
    document.body.appendChild(tooltip);
    
    setTimeout(() => {
        tooltip.style.opacity = '0';
        tooltip.style.transition = 'opacity 0.3s ease';
        setTimeout(() => tooltip.remove(), 300);
    }, 3000);
});
</script>
{% endblock %}